<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Store (React)</title>
  <link rel="stylesheet" href="style.css" />
  <!-- ◊ò◊¢◊ô◊†◊™ React ◊ï÷æReactDOM -->
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
</head>
<body class="with-nav">
  <div id="root"></div>

  <script src="navbar.js"></script>

  <!-- ◊®◊õ◊ô◊ë React -->
  <script type="text/babel">

    function Store() {
      const [products, setProducts] = React.useState([]);
      const [search, setSearch] = React.useState('');

      React.useEffect(() => {
        fetch('/products')
          .then(res => res.json())
          .then(setProducts);
      }, []);

      const filtered = products.filter(p =>
        p.name.toLowerCase().includes(search.toLowerCase()) ||
        p.description.toLowerCase().includes(search.toLowerCase())
      );

      return (
        <div className="form-container">
          <h1>NBA Jerseys Store (React)</h1>
          <input
            type="text"
            placeholder="Search..."
            value={search}
            onChange={e => setSearch(e.target.value)}
            className="search-bar"
          />
          {filtered.map(p => (
            <div key={p.id} className="item-box">
              <h3>{p.name}</h3>
              <p>{p.description}</p>
              <p><strong>Price:</strong> ${p.price.toFixed(2)}</p>
              <div style={{ display: 'flex', gap: '10px', marginTop: '10px' }}>
                <button onClick={() => addToCart(p.id)}>üõí Add to Cart</button>
                <button onClick={() => addToWishlist(p.id)}>‚ù§Ô∏è Add to Wishlist</button>
              </div>
            </div>
          ))}
        </div>
      );
    }

    function addToCart(productId) {
      fetch('/add-to-cart', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ productId, quantity: 1 })
             }).then(res => {
         if (res.status === 401) {
           alert("You must be logged in to add items.");
           window.location.href = 'login.html';
         } else {
           alert("Added to cart! (Removed from wishlist if present)");
         }
       });
    }

    function addToWishlist(productId) {
      fetch('/wishlist', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ productId })
      }).then(res => {
        if (res.status === 401) {
          alert("You must be logged in to add items to your wishlist.");
          window.location.href = 'login.html';
        } else if (res.status === 400) {
          res.text().then(message => {
            if (message.includes('already in wishlist')) {
              alert("Item is already in your wishlist!");
            } else {
              alert(message);
            }
          });
        } else if (res.ok) {
          alert("Added to wishlist!");
        } else {
          alert("Failed to add to wishlist");
        }
      }).catch(error => {
        console.error('Error adding to wishlist:', error);
        alert("Failed to add to wishlist");
      });
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<Store />);
  </script>
</body>
</html>
